<VirtualHost *:80>
	ServerAdmin webmaster@localhost
	DocumentRoot /var/www/html
	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
<VirtualHost invidious.048596.xyz:80>
	ServerAdmin webmaster@localhost
	DocumentRoot /var/www/html
	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined
Redirect / https://invidious.048596.xyz/
</VirtualHost>

<VirtualHost *:443>
	ServerAdmin webmaster@localhost
	DocumentRoot /var/www/html
	ErrorLog ${APACHE_LOG_DIR}/error.log
	CustomLog ${APACHE_LOG_DIR}/access.log combined
SSLProxyEngine on
SSLCertificateFile /home/debian/dehydrated/certs/invidious.048596.xyz/cert.pem
SSLCertificateKeyFile /home/debian/dehydrated/certs/invidious.048596.xyz/privkey.pem
SSLCertificateChainFile /home/debian/dehydrated/certs/invidious.048596.xyz/fullchain.pem
ProxyAddHeaders off
RewriteEngine  on
AllowEncodedSlashes On
RewriteCond %{QUERY_STRING} ^(.*)&host=(.*(googlevideo.com|youtube.com))(.local=true)?$
RewriteRule    "^/videoplayback$"  "https://%2/videoplayback?%1"  [P,END]
RewriteCond %{QUERY_STRING} ^(.*hls_chunk_host=(.*(googlevideo.com|youtube.com)).*)(.local=true)?$
RewriteRule    "^/videoplayback$"  "https://%2/videoplayback?%1"  [P,END]
RewriteCond %{QUERY_STRING} ^(.*mn=([0-9a-z-]*).*fvip=([0-9]*).*)(.local=true)?$
RewriteRule    "^/videoplayback$"  "https://r%3---%2.googlevideo.com/videoplayback?%1"  [P,END]
RewriteCond %{QUERY_STRING} ^(.*fvip=([0-9]*).*mn=([0-9a-z-]*).*)(.local=true)?$
RewriteRule    "^/videoplayback$"  "https://r%2---%3.googlevideo.com/videoplayback?%1"  [P,END]
RewriteRule    "^/videoplayback$"  - [R=404]
Header edit Location "(^http[s]?://)([a-zA-Z0-9\.\-]+)(:\d+)?/videoplayback(.*)" "/videoplayback$4&host=$2"
ProxyPass         "/" "http://localhost:3000/" nocanon
ProxyPassReverse  "/" "http://localhost:3000/"
</VirtualHost>


# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
